---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import ProductCard from '../../components/products/ProductCard.astro';
import ProductFilter from '../../components/products/ProductFilter.astro';
import { multiKlimaProducts } from '../../data/products/multi-klima';

// Get filter parameters from URL
const url = new URL(Astro.request.url);
const brandFilter = url.searchParams.get('brand');
const unitsFilter = url.searchParams.get('units');
const sortBy = url.searchParams.get('sort') || 'featured';

// Filter products
let filteredProducts = [...multiKlimaProducts];

if (brandFilter) {
  filteredProducts = filteredProducts.filter(p =>
    p.manufacturer?.toLowerCase() === brandFilter.toLowerCase()
  );
}

if (unitsFilter) {
  filteredProducts = filteredProducts.filter(p =>
    p.units === parseInt(unitsFilter)
  );
}

// Sort products
switch(sortBy) {
  case 'price-asc':
    filteredProducts.sort((a, b) => a.price - b.price);
    break;
  case 'price-desc':
    filteredProducts.sort((a, b) => b.price - a.price);
    break;
  case 'name':
    filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
    break;
  default:
    filteredProducts.sort((a, b) => {
      if (a.isFeatured && !b.isFeatured) return -1;
      if (!a.isFeatured && b.isFeatured) return 1;
      if (a.isOnSale && !b.isOnSale) return -1;
      if (!a.isOnSale && b.isOnSale) return 1;
      return 0;
    });
}

// SEO
const pageTitle = 'Multi Split Klima Uređaji | RDM Klimatizacija';
const pageDescription = 'Multi split klima sustavi za 2, 3 ili 4 prostorije. Toshiba, Haier i Maxon multi klima uređaji s jednom vanjskom jedinicom.';
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <Header />

  <main class="products-page">
    <!-- Hero Section -->
    <section class="hero">
      <div class="container">
        <div class="hero__content">
          <h1 class="hero__title">Multi Split Klima Sustavi</h1>
          <p class="hero__subtitle">
            Jedna vanjska jedinica, više unutarnjih jedinica - idealno rješenje za više prostorija
          </p>
        </div>
      </div>
    </section>

    <!-- Breadcrumb -->
    <nav class="breadcrumb" aria-label="Breadcrumb">
      <div class="container">
        <ol class="breadcrumb__list">
          <li class="breadcrumb__item">
            <a href="/" class="breadcrumb__link">Početna</a>
          </li>
          <li class="breadcrumb__item">
            <span class="breadcrumb__current">Multi Klima Uređaji</span>
          </li>
        </ol>
      </div>
    </nav>

    <!-- Products Section -->
    <section class="products-section">
      <div class="container">
        <div class="products-layout">
          <!-- Sidebar Filters -->
          <aside class="products-layout__sidebar">
            <ProductFilter
              currentPath="/multi-klima"
              categories={[
                { name: 'Multi Klima', href: '/multi-klima', count: multiKlimaProducts.length, active: true }
              ]}
              manufacturers={[
                { name: 'Toshiba', param: 'toshiba' },
                { name: 'Haier', param: 'haier' },
                { name: 'Maxon', param: 'maxon' }
              ]}
              additionalFilters={[
                {
                  title: 'Broj jedinica',
                  param: 'units',
                  options: [
                    { name: '2 jedinice', value: '2' },
                    { name: '3 jedinice', value: '3' },
                    { name: '4 jedinice', value: '4' }
                  ]
                }
              ]}
            />
          </aside>

          <!-- Main Content -->
          <div class="products-layout__main">
            <!-- Toolbar -->
            <div class="toolbar">
              <div class="toolbar__info">
                <span class="toolbar__count">{filteredProducts.length} proizvoda</span>
              </div>
              <div class="toolbar__actions">
                <select class="toolbar__sort" onchange="window.location.href=this.value">
                  <option value="?sort=featured" selected={sortBy === 'featured'}>Preporučeno</option>
                  <option value="?sort=price-asc" selected={sortBy === 'price-asc'}>Cijena: Manja prema većoj</option>
                  <option value="?sort=price-desc" selected={sortBy === 'price-desc'}>Cijena: Veća prema manjoj</option>
                  <option value="?sort=name" selected={sortBy === 'name'}>Naziv: A-Z</option>
                </select>
              </div>
            </div>

            <!-- Products Grid -->
            <div class="products-grid">
              {filteredProducts.map((product) => (
                <ProductCard product={{
                  ...product,
                  href: `/multi-klima/${product.slug}`,
                  description: `Multi split ${product.units} jedinice - ${product.specifications.maxCooling} hlađenje`,
                  energyClass: product.specifications.energyClass,
                  seer: product.specifications.seer,
                  scop: product.specifications.scop,
                  features: product.features.slice(0, 3)
                }} />
              ))}
            </div>

            {filteredProducts.length === 0 && (
              <div class="no-products">
                <p>Nema proizvoda koji odgovaraju vašem odabiru.</p>
                <a href="/multi-klima" class="btn btn--primary">Prikaži sve proizvode</a>
              </div>
            )}
          </div>
        </div>
      </div>
    </section>

    <!-- Info Section -->
    <section class="info-section">
      <div class="container">
        <div class="info-grid">
          <div class="info-card">
            <h3>Što je Multi Split sustav?</h3>
            <p>Multi split klima sustav omogućava povezivanje više unutarnjih jedinica na jednu vanjsku jedinicu, što je idealno rješenje za klimatizaciju više prostorija.</p>
          </div>
          <div class="info-card">
            <h3>Prednosti Multi Split sustava</h3>
            <ul>
              <li>Ušteda prostora - samo jedna vanjska jedinica</li>
              <li>Individualna kontrola temperature u svakoj prostoriji</li>
              <li>Energetski učinkovit</li>
              <li>Tiši rad vanjski jedinice</li>
            </ul>
          </div>
          <div class="info-card">
            <h3>Kako odabrati pravi sustav?</h3>
            <p>Pri odabiru multi split sustava važno je uzeti u obzir broj i veličinu prostorija koje želite klimatizirati, te ukupnu potrebnu snagu hlađenja i grijanja.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>

<style>
  .products-page {
    min-height: 100vh;
    background: var(--color-gray-50);
  }

  /* Hero Section */
  .hero {
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
    color: var(--color-white);
    padding: var(--space-12) 0 var(--space-16);
  }

  .hero__content {
    text-align: center;
    max-width: 800px;
    margin: 0 auto;
  }

  .hero__title {
    font-size: var(--text-4xl);
    font-weight: var(--font-bold);
    margin-bottom: var(--space-4);
  }

  .hero__subtitle {
    font-size: var(--text-xl);
    opacity: 0.95;
  }

  /* Breadcrumb */
  .breadcrumb {
    background: var(--color-white);
    border-bottom: 1px solid var(--color-gray-200);
    padding: var(--space-3) 0;
  }

  .breadcrumb__list {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .breadcrumb__item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .breadcrumb__item:not(:last-child)::after {
    content: '/';
    color: var(--color-gray-400);
  }

  .breadcrumb__link {
    color: var(--color-gray-600);
    text-decoration: none;
    font-size: var(--text-sm);
    transition: color var(--transition-fast);
  }

  .breadcrumb__link:hover {
    color: var(--color-primary);
  }

  .breadcrumb__current {
    color: var(--text-primary);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
  }

  /* Products Section */
  .products-section {
    padding: var(--space-8) 0;
  }

  .products-layout {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: var(--space-8);
  }

  /* Toolbar */
  .toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-4);
    background: var(--color-white);
    border-radius: var(--border-radius-lg);
    margin-bottom: var(--space-6);
  }

  .toolbar__count {
    color: var(--text-secondary);
    font-size: var(--text-sm);
  }

  .toolbar__sort {
    padding: var(--space-2) var(--space-3);
    border: 1px solid var(--color-gray-300);
    border-radius: var(--border-radius-md);
    background: var(--color-white);
    font-size: var(--text-sm);
    cursor: pointer;
  }

  /* Products Grid */
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--space-6);
  }

  /* No Products */
  .no-products {
    text-align: center;
    padding: var(--space-16) var(--space-4);
    background: var(--color-white);
    border-radius: var(--border-radius-lg);
  }

  .no-products p {
    margin-bottom: var(--space-4);
    color: var(--text-secondary);
  }

  /* Info Section */
  .info-section {
    background: var(--color-white);
    padding: var(--space-12) 0;
    border-top: 1px solid var(--color-gray-200);
  }

  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-8);
  }

  .info-card h3 {
    font-size: var(--text-xl);
    font-weight: var(--font-semibold);
    margin-bottom: var(--space-4);
    color: var(--text-primary);
  }

  .info-card p,
  .info-card ul {
    color: var(--text-secondary);
    line-height: 1.8;
  }

  .info-card ul {
    list-style: none;
    padding-left: 0;
  }

  .info-card ul li {
    position: relative;
    padding-left: var(--space-6);
    margin-bottom: var(--space-2);
  }

  .info-card ul li::before {
    content: '✓';
    position: absolute;
    left: 0;
    color: var(--color-success);
    font-weight: var(--font-bold);
  }

  /* Button */
  .btn {
    display: inline-block;
    padding: var(--space-3) var(--space-6);
    border-radius: var(--border-radius-md);
    font-weight: var(--font-semibold);
    text-decoration: none;
    transition: all var(--transition-fast);
  }

  .btn--primary {
    background: var(--color-primary);
    color: var(--color-white);
  }

  .btn--primary:hover {
    background: var(--color-primary-hover);
    transform: translateY(-2px);
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .products-layout {
      grid-template-columns: 1fr;
    }

    .products-layout__sidebar {
      display: none;
    }
  }

  @media (max-width: 768px) {
    .hero__title {
      font-size: var(--text-3xl);
    }

    .hero__subtitle {
      font-size: var(--text-lg);
    }

    .products-grid {
      grid-template-columns: 1fr;
    }

    .toolbar {
      flex-direction: column;
      gap: var(--space-3);
      align-items: flex-start;
    }

    .toolbar__sort {
      width: 100%;
    }

    .info-grid {
      grid-template-columns: 1fr;
    }
  }
</style>