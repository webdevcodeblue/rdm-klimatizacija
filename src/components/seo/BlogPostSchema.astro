---
import { SITE_CONFIG, getImageUrl, getFullUrl } from '../../config/site';

// BlogPosting Schema Component for SEO
// Generates JSON-LD structured data for blog posts

export interface Props {
  post: {
    title: string;
    description: string;
    author?: string;
    date: Date | string;
    image?: string;
    category?: string;
    tags?: string[];
    slug: string;
  };
}

const { post } = Astro.props;
const siteUrl = SITE_CONFIG.url;
const currentUrl = getFullUrl(Astro.url.pathname);

// Format date to ISO string
const publishDate = post.date instanceof Date
  ? post.date.toISOString()
  : new Date(post.date).toISOString();

// Build BlogPosting schema
const blogPostingSchema = {
  '@context': 'https://schema.org',
  '@type': 'BlogPosting',
  headline: post.title,
  description: post.description,
  author: {
    '@type': 'Person',
    name: post.author || `${SITE_CONFIG.company.name} Tim`,
    url: siteUrl
  },
  publisher: {
    '@type': 'Organization',
    name: SITE_CONFIG.company.name,
    url: SITE_CONFIG.url,
    logo: {
      '@type': 'ImageObject',
      url: getImageUrl(SITE_CONFIG.brand.logo),
      width: 200,
      height: 60
    }
  },
  datePublished: publishDate,
  dateModified: publishDate,
  image: post.image ? getImageUrl(post.image) : getImageUrl('/og-image-blog.jpg'),
  mainEntityOfPage: {
    '@type': 'WebPage',
    '@id': currentUrl
  },
  url: currentUrl,
  ...(post.category ? {
    articleSection: post.category
  } : {}),
  ...(post.tags && post.tags.length > 0 ? {
    keywords: post.tags.join(', ')
  } : {}),
  inLanguage: 'hr-HR',
  potentialAction: {
    '@type': 'ReadAction',
    target: currentUrl
  },
  wordCount: 800, // Estimated average
  timeRequired: 'PT4M', // 4 minutes read time estimate
  isAccessibleForFree: true,
  isPartOf: {
    '@type': 'Blog',
    name: `${SITE_CONFIG.company.name} Blog`,
    description: 'Savjeti i vijesti o klima ureÄ‘ajima, dizalicama topline i ventilaciji',
    url: getFullUrl('/blog')
  }
};
---

<script type="application/ld+json" set:html={JSON.stringify(blogPostingSchema, null, 2)} />