---
// ProductCard komponenta za prikaz pojedinačnog proizvoda
export interface Product {
  id: string;
  slug: string;
  name: string;
  manufacturer: string;
  category: string;
  price: number;
  originalPrice?: number;
  power: string;
  area: string;
  energyClass: string;
  seer?: number;
  scop?: number;
  features: string[];
  badge?: string;
  image: string;
  inStock: boolean;
}

export interface Props {
  product: Product;
  viewMode?: 'grid' | 'list';
}

const { product, viewMode = 'grid' } = Astro.props;

const discountPercentage = product.originalPrice
  ? Math.round((1 - product.price / product.originalPrice) * 100)
  : 0;
---

<article class={`product-card product-card--${viewMode}`} data-product-id={product.id}>
  {product.badge && (
    <span class={`product-card__badge product-card__badge--${product.badge.toLowerCase().replace(' ', '-')}`}>
      {product.badge}
    </span>
  )}

  {discountPercentage > 0 && !product.badge && (
    <span class="product-card__badge product-card__badge--discount">
      -{discountPercentage}%
    </span>
  )}

  <a href={`/proizvodi/${product.slug}`} class="product-card__image-link">
    <div class="product-card__image">
      <img
        src={product.image}
        alt={product.name}
        loading="lazy"
        width="300"
        height="300"
      />
      <div class="product-card__overlay">
        <button class="product-card__quick-view" aria-label="Brzi pregled">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
        <button class="product-card__compare" aria-label="Dodaj za usporedbu" data-product-id={product.id}>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 4H6v16"></path>
            <path d="m12 8-4 4 4 4"></path>
            <path d="m16 12-4 4"></path>
          </svg>
        </button>
      </div>
    </div>
  </a>

  <div class="product-card__content">
    <div class="product-card__header">
      <span class="product-card__manufacturer">{product.manufacturer}</span>
      <span class="product-card__category">{product.category}</span>
    </div>

    <h3 class="product-card__name">
      <a href={`/proizvodi/${product.slug}`}>{product.name}</a>
    </h3>

    <div class="product-card__specs">
      <div class="spec" title="Snaga hlađenja/grijanja">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
        </svg>
        <span>{product.power}</span>
      </div>
      <div class="spec" title="Preporučena površina">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
        </svg>
        <span>{product.area}</span>
      </div>
      <div class="spec spec--energy" title="Energetska klasa">
        {product.energyClass}
      </div>
    </div>

    {product.seer && product.scop && (
      <div class="product-card__efficiency">
        <span class="efficiency-badge" title="SEER - Sezonska energetska učinkovitost hlađenja">
          SEER {product.seer}
        </span>
        <span class="efficiency-badge" title="SCOP - Sezonska energetska učinkovitost grijanja">
          SCOP {product.scop}
        </span>
      </div>
    )}

    <div class="product-card__features">
      {product.features.slice(0, 3).map((feature) => (
        <span class="feature-tag">{feature}</span>
      ))}
      {product.features.length > 3 && (
        <span class="feature-tag feature-tag--more">+{product.features.length - 3}</span>
      )}
    </div>

    <div class="product-card__footer">
      <div class="product-card__price">
        {product.originalPrice && (
          <span class="price-original">{product.originalPrice.toLocaleString('hr-HR')}€</span>
        )}
        <span class="price-current">{product.price.toLocaleString('hr-HR')}€</span>
        <span class="price-vat">s PDV-om</span>
      </div>

      <div class="product-card__actions">
        {product.inStock ? (
          <>
            <button class="btn btn--primary btn--icon" data-product-id={product.id} data-action="inquiry">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 2L11 13"></path>
                <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
              </svg>
              Pošalji upit
            </button>
            <a href={`/proizvodi/${product.slug}`} class="btn btn--secondary">
              Detalji
            </a>
          </>
        ) : (
          <span class="product-card__out-of-stock">
            Trenutno nedostupno
          </span>
        )}
      </div>
    </div>
  </div>
</article>

<style>
  /* Grid view */
  .product-card {
    background: var(--color-white);
    border-radius: var(--border-radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-card);
    transition: all var(--transition-base);
    position: relative;
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .product-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-card-hover);
  }

  .product-card__badge {
    position: absolute;
    top: var(--space-3);
    left: var(--space-3);
    z-index: 2;
    padding: var(--space-1) var(--space-3);
    border-radius: var(--border-radius-full);
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wide);
  }

  .product-card__badge--akcija {
    background: var(--color-danger);
    color: var(--color-white);
  }

  .product-card__badge--novo {
    background: var(--color-success);
    color: var(--color-white);
  }

  .product-card__badge--discount {
    background: var(--color-warning);
    color: var(--text-primary);
  }

  .product-card__badge--premium {
    background: var(--color-primary);
    color: var(--color-white);
  }

  .product-card__image-link {
    display: block;
    text-decoration: none;
  }

  .product-card__image {
    position: relative;
    height: 250px;
    background: var(--color-gray-50);
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .product-card__image img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    transition: transform var(--transition-base);
  }

  .product-card:hover .product-card__image img {
    transform: scale(1.05);
  }

  .product-card__overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-3);
    opacity: 0;
    transition: opacity var(--transition-fast);
  }

  .product-card:hover .product-card__overlay {
    opacity: 1;
  }

  .product-card__quick-view,
  .product-card__compare {
    width: 44px;
    height: 44px;
    background: var(--color-white);
    border: none;
    border-radius: var(--border-radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transform: scale(0.8);
    transition: all var(--transition-fast);
  }

  .product-card:hover .product-card__quick-view,
  .product-card:hover .product-card__compare {
    transform: scale(1);
  }

  .product-card__quick-view:hover,
  .product-card__compare:hover {
    background: var(--color-primary);
    color: var(--color-white);
  }

  .product-card__content {
    padding: var(--space-4);
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }

  .product-card__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--space-2);
  }

  .product-card__manufacturer {
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    color: var(--color-primary);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
  }

  .product-card__category {
    font-size: var(--text-xs);
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
  }

  .product-card__name {
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    margin-bottom: var(--space-3);
    line-height: var(--leading-tight);
  }

  .product-card__name a {
    color: var(--text-primary);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .product-card__name a:hover {
    color: var(--color-primary);
  }

  .product-card__specs {
    display: flex;
    gap: var(--space-3);
    margin-bottom: var(--space-3);
  }

  .spec {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    font-size: var(--text-sm);
    color: var(--text-secondary);
  }

  .spec svg {
    color: var(--color-primary);
  }

  .spec--energy {
    padding: var(--space-1) var(--space-2);
    background: var(--color-success);
    color: var(--color-white);
    border-radius: var(--border-radius-base);
    font-weight: var(--font-semibold);
  }

  .product-card__efficiency {
    display: flex;
    gap: var(--space-2);
    margin-bottom: var(--space-3);
  }

  .efficiency-badge {
    padding: var(--space-1) var(--space-2);
    background: var(--color-info);
    color: var(--color-white);
    border-radius: var(--border-radius-base);
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
  }

  .product-card__features {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    margin-bottom: var(--space-4);
    flex-grow: 1;
  }

  .feature-tag {
    padding: var(--space-1) var(--space-2);
    background: var(--color-gray-100);
    color: var(--text-secondary);
    border-radius: var(--border-radius-base);
    font-size: var(--text-xs);
  }

  .feature-tag--more {
    background: var(--color-primary);
    color: var(--color-white);
  }

  .product-card__footer {
    border-top: 1px solid var(--border-color);
    padding-top: var(--space-4);
    margin-top: auto;
  }

  .product-card__price {
    display: flex;
    align-items: baseline;
    gap: var(--space-2);
    margin-bottom: var(--space-3);
  }

  .price-original {
    font-size: var(--text-sm);
    color: var(--text-muted);
    text-decoration: line-through;
  }

  .price-current {
    font-size: var(--text-2xl);
    font-weight: var(--font-bold);
    color: var(--color-primary);
  }

  .price-vat {
    font-size: var(--text-xs);
    color: var(--text-muted);
  }

  .product-card__actions {
    display: flex;
    gap: var(--space-2);
  }

  .btn {
    padding: var(--space-2) var(--space-4);
    border: none;
    border-radius: var(--border-radius-lg);
    font-weight: var(--font-semibold);
    cursor: pointer;
    transition: all var(--transition-fast);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
  }

  .btn--primary {
    background: var(--color-primary);
    color: var(--color-white);
    flex: 1;
  }

  .btn--primary:hover {
    background: var(--color-primary-hover);
    transform: translateY(-2px);
  }

  .btn--secondary {
    background: var(--color-gray-100);
    color: var(--text-primary);
    flex: 0 0 auto;
  }

  .btn--secondary:hover {
    background: var(--color-gray-200);
  }

  .btn--icon svg {
    width: 18px;
    height: 18px;
  }

  .product-card__out-of-stock {
    display: block;
    text-align: center;
    padding: var(--space-3);
    background: var(--color-gray-100);
    color: var(--text-muted);
    border-radius: var(--border-radius-lg);
    font-weight: var(--font-semibold);
  }

  /* List view */
  .product-card--list {
    flex-direction: row;
    height: auto;
  }

  .product-card--list .product-card__image {
    height: 200px;
    width: 200px;
    flex-shrink: 0;
  }

  .product-card--list .product-card__content {
    flex: 1;
  }

  .product-card--list .product-card__footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .product-card--list .product-card__price {
    margin-bottom: 0;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .product-card--list {
      flex-direction: column;
    }

    .product-card--list .product-card__image {
      width: 100%;
      height: 200px;
    }

    .product-card--list .product-card__footer {
      flex-direction: column;
      gap: var(--space-3);
    }

    .product-card--list .product-card__price {
      margin-bottom: var(--space-3);
    }

    .btn {
      width: 100%;
    }
  }
</style>

<script>
  // Handle quick view
  document.querySelectorAll('.product-card__quick-view').forEach(button => {
    button.addEventListener('click', (e) => {
      e.preventDefault();
      const card = button.closest('.product-card');
      const productId = card?.dataset.productId;
      if (productId) {
        // Open quick view modal (implement modal separately)
        console.log('Quick view for product:', productId);
      }
    });
  });

  // Handle compare
  document.querySelectorAll('.product-card__compare').forEach(button => {
    button.addEventListener('click', (e) => {
      e.preventDefault();
      const productId = button.dataset.productId;
      if (productId) {
        // Add to compare list
        console.log('Add to compare:', productId);
      }
    });
  });

  // Handle inquiry
  document.querySelectorAll('[data-action="inquiry"]').forEach(button => {
    button.addEventListener('click', (e) => {
      e.preventDefault();
      const productId = button.dataset.productId;
      if (productId) {
        // Open inquiry modal
        console.log('Inquiry for product:', productId);
      }
    });
  });
</script>